<!doctype html>
<html lang="ja" class="font-medium">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FGSSmap | 思い出の地図を見る</title>
  <meta name="google-site-verification" content="mcTa1rUBccaIuG2aw-ZKEvUvN-SuBy3gYi_vE9cPpps" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{--base:16px;--primary:#5c6bc0;--accent:#ff7043;--bg:#f9f9f9;--card:#fff;--text:#333;--muted:#777}
    html{font-size:var(--base);scroll-behavior:smooth}
    html.font-small{font-size:14px}html.font-medium{font-size:16px}html.font-large{font-size:18px}
    body{font-family:'Montserrat',sans-serif;background:var(--bg);color:var(--text);line-height:1.6;margin:0}
    *{box-sizing:border-box}a{color:inherit;text-decoration:none}
    .container{max-width:1000px;margin:0 auto;padding:0 20px}

    header{background:var(--primary);color:#fff;position:sticky;top:0;z-index:1000}
    .nav{display:flex;align-items:center;justify-content:space-between;height:64px;gap:12px;padding:0 12px}
    .left-area,.center-area,.right-area{display:flex;align-items:center;gap:8px}
    .font-size-selector{display:flex;gap:6px;align-items:center}
    .font-size-button{background:none;border:2px solid #fff;border-radius:4px;color:#fff;padding:4px 8px;font-size:.9rem;cursor:pointer}
    .font-size-button.active{background:#fff;color:var(--primary)}
    .logo-title{display:flex;align-items:center;gap:10px;justify-content:center}
    .logo-title img{width:40px;height:40px;object-fit:contain}
    .site-title{font-size:1.2rem;font-weight:600}

    #fontToggle{display:none;background:none;border:2px solid #fff;color:#fff;border-radius:6px;padding:6px 8px;font-weight:600;cursor:pointer}

    .hero{background:linear-gradient(rgba(92,107,192,.8),rgba(92,107,192,.8)),url('hero-bg.jpg')center/cover no-repeat;color:#fff;text-align:center;padding:80px 20px}
    .hero h1{font-size:2.5rem;margin:0 0 16px}section{margin-top:60px;text-align:center}
    section h2{font-size:1.6rem;color:var(--primary);margin-bottom:24px}
    .map-container iframe{width:100%;max-width:1000px;height:500px;border:none;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.1)}
    .search-bar{margin-bottom:24px}
    .search-bar input{width:100%;max-width:400px;padding:10px 12px;border:1px solid #ccc;border-radius:4px;font-size:.95rem}
    .photo-cards,.memory-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:24px;margin-bottom:40px}
    .photo-card,.memory-card{background:var(--card);border-radius:8px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.1);transition:transform .18s,box-shadow .18s;text-align:left}
    .photo-card:hover,.memory-card:hover{transform:translateY(-6px);box-shadow:0 6px 18px rgba(0,0,0,.15)}
    .photo-card img{width:100%;height:auto;display:block} /* 元の縦横比を維持する設定 */
    .memory-card-content,.photo-card .memory-card-content{padding:16px}
    .photo-card h3,.memory-card h3{font-size:1.1rem;margin:0 0 8px}
    .photo-card p,.memory-card p{color:var(--muted);font-size:.95rem;margin:0 0 12px}
    .links-row{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-top:12px}
    .external-link{display:inline-flex;align-items:center;gap:8px;background:var(--accent);color:#fff;padding:10px 14px;border-radius:6px;font-weight:600;text-decoration:none}
    .external-link.secondary{background:#4a90e2}
    .insta-link{display:inline-block;margin-top:16px;background:var(--accent);color:#fff;padding:10px 18px;border-radius:4px;font-weight:600}
    footer{background:#eee;color:#555;text-align:center;padding:20px;margin-top:60px;font-size:.85rem}
    #toTop{position:fixed;right:30px;bottom:30px;display:none;background:var(--primary);color:#fff;border:none;padding:10px 12px;border-radius:4px;cursor:pointer;font-size:1.2rem;z-index:100}

    /* フォーカス可視化 */
    .font-size-button:focus, #fontToggle:focus, .external-link:focus, .photo-card:focus, .memory-card:focus {
      outline:3px solid rgba(92,107,192,0.25);
      outline-offset:2px;
    }

    @media(max-width:760px){
      .nav{height:56px;padding:0 10px}
      .logo-title img{width:36px;height:36px}
      .site-title{font-size:1rem}
      .font-size-selector{display:none}
      #fontToggle{display:inline-flex}
      .font-size-button{padding:3px 6px;font-size:.78rem}
    }

    @media(max-width:420px){
      .hero{padding:56px 12px}
      .hero h1{font-size:1.6rem}
      .photo-card img{height:auto}
    }
  </style>
</head>
<body>
  <header>
    <div class="container nav" role="navigation" aria-label="メインナビゲーション">
      <div class="left-area">
        <button id="fontToggle" tabindex="0" aria-expanded="false" aria-controls="fontSelector" aria-label="フォントサイズ切替">A</button>

        <div class="font-size-selector" id="fontSelector" role="toolbar" aria-label="フォントサイズ">
          <button class="font-size-button" data-size="small" aria-pressed="false">小</button>
          <button class="font-size-button active" data-size="medium" aria-pressed="true">中</button>
          <button class="font-size-button" data-size="large" aria-pressed="false">大</button>
        </div>
      </div>

      <div class="center-area" style="flex:1;justify-content:center">
        <div class="logo-title" aria-hidden="false">
          <a href="/" style="display:flex;align-items:center;gap:10px;color:inherit;text-decoration:none;">
            <img src="FGSSmap-icon.png.png" alt="FGSSmapロゴ">
            <span class="site-title">FGSSmap</span>
          </a>
        </div>
      </div>

      <div class="right-area">
        <!-- ダークモード削除のため右側は空にしています -->
      </div>
    </div>
  </header>

  <main>
    <div class="hero">
      <div class="container">
        <h1>みんなの思い出を地図に刻もう</h1>
        <p>大学生活のワクワクを、FGSSmapでいつでも振り返ろう。</p>
      </div>
    </div>

    <section id="map">
      <div class="container">
        <h2>🗺️ 思い出マップ</h2>
        <div class="map-container" aria-live="polite">
          <iframe src="https://www.google.com/maps/d/u/0/embed?mid=1nTgYFWkXf1UQHwGZCwdXuRv-aopgUkY&hl=ja&ll=34.12382662506017,131.43323404999998&z=13" loading="lazy" title="思い出マップ" aria-describedby="mapDesc"></iframe>
          <div id="mapDesc" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;">大学周辺で共有された思い出の位置情報を表示する埋め込みマップです</div>
        </div>
      </div>
    </section>

    <section id="memories">
      <div class="container">
        <h2>📍 思い出の場所一覧</h2>
        <div class="search-bar">
          <input id="searchInput" type="search" placeholder="場所名で検索…" aria-label="場所名で検索" aria-controls="cardsContainer photoCardsContainer">
        </div>

        <div class="photo-cards" id="photoCardsContainer" aria-live="polite" role="list"></div>
        <div class="memory-cards" id="cardsContainer" aria-live="polite" role="list"></div>
      </div>
    </section>

    <section id="about">
      <div class="container organization">
        <h2>🎓 運営団体について</h2>
        <p>このプロジェクトは、山口大学国際総合科学部公認サークル <strong>Palet's</strong> によって運営されています。思い出を形にし、みんなで共有することで、つながりを深めます。</p>

      <div class="links-row" role="navigation" aria-label="外部リンク">
        <a class="external-link" href="https://www.instagram.com/palets_fgss/" target="_blank" rel="noopener noreferrer" aria-label="Palet's Instagram">📸 Instagram</a>
        <a class="external-link secondary" href="https://www.yamaguchi-u.ac.jp/gss/index.html" target="_blank" rel="noopener noreferrer" aria-label="山口大学国際総合科学部 公式サイト">🎓 山口大学 国際総合科学部</a>
      </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2025 Palet's. All rights reserved.</p>
    </div>
  </footer>

  <button id="toTop" aria-label="トップに戻る">↑</button>

  <script>
    const $ = s => document.querySelector(s), $$ = s => Array.from(document.querySelectorAll(s));

    /* フォントサイズ切替（保存） */
    (function(){
      const btns = $$('.font-size-button');
      const toggle = $('#fontToggle');
      const selector = $('#fontSelector');

      const apply = size => {
        document.documentElement.classList.remove('font-small','font-medium','font-large');
        document.documentElement.classList.add(size==='small'?'font-small':size==='large'?'font-large':'font-medium');
        btns.forEach(b=>{ const on = b.dataset.size===size; b.classList.toggle('active',on); b.setAttribute('aria-pressed', on); });
        try{ localStorage.setItem('fgss_font_size', size); }catch(e){}
      };

      btns.forEach(b=>{
        b.addEventListener('click', ()=> apply(b.dataset.size));
        b.addEventListener('keydown', e=>{
          if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); b.click(); }
        });
      });

      const setSelectorVisible = visible => {
        selector.style.display = visible ? 'flex' : 'none';
        toggle.setAttribute('aria-expanded', String(visible));
      };
      toggle.addEventListener('click', ()=> setSelectorVisible(getComputedStyle(selector).display === 'none'));
      toggle.addEventListener('keydown', e=>{
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggle.click(); }
        if (e.key === 'ArrowDown') { e.preventDefault(); btns[0].focus(); setSelectorVisible(true); }
      });

      const saved = (()=>{try{return localStorage.getItem('fgss_font_size')}catch(e){return null}})();
      apply(saved || 'medium');

      let rto;
      window.addEventListener('resize', ()=>{
        clearTimeout(rto);
        rto = setTimeout(()=>{ if (window.innerWidth > 760) selector.style.display = ''; }, 150);
      });
    })();

    /* Back to top */
    (function(){
      const toTop = $('#toTop');
      const showClass = 'visible';
      const ensureClass = () => {
        if (window.pageYOffset > 300) toTop.style.display = 'block';
        else toTop.style.display = 'none';
      };
      window.addEventListener('scroll', () => ensureClass());
      toTop.addEventListener('click', ()=> window.scrollTo({top:0,behavior:'smooth'}));
      ensureClass();
    })();

    /* 写真カードデータ（例） */
    const photoCardsData = [
      { img:'山口大学.jpg', title:'山口大学', desc:'山口大学は山口県にある国立大。吉田・常盤・小串の３キャンパスで文系・理系・医学・国際総合科学まで幅広く学べ、約１万人の学生が地域連携やSDGsにもガンガン挑戦中！' }
    ];

    /* 写真カード描画 */
    (function(){
      const container = $('#photoCardsContainer');
      photoCardsData.forEach(item=>{
        const d = document.createElement('article'); d.className='photo-card';
        // 画像は幅100% 高さ自動で元の縦横比を保つ
        d.innerHTML = `<img src="${item.img}" alt="${item.title}"><div class="memory-card-content"><h3>${item.title}</h3><p>${item.desc}</p></div>`;
        container.appendChild(d);
      });
    })();

    /* KML -> カード生成（CORSに注意） */
    (function(){
      const kmlUrl = 'https://www.google.com/maps/d/kml?hl=ja&mid=1nTgYFWkXf1UQHwGZCwdXuRv-aopgUkY&nl=1&forcekml=1';
      fetch(kmlUrl).then(r=>{
        if (!r.ok) throw new Error('HTTP ' + r.status);
        return r.text();
      }).then(txt=>{
        const doc = new DOMParser().parseFromString(txt,'text/xml');
        const placemarks = doc.querySelectorAll('Placemark');
        const container = $('#cardsContainer');
        if(!placemarks.length) {
          const msg = document.createElement('p');
          msg.textContent = 'マップの場所が見つかりませんでした。';
          container.appendChild(msg);
          return;
        }
        placemarks.forEach(pm=>{
          const name = (pm.querySelector('name')?.textContent || '名称不明');
          const desc = (pm.querySelector('description')?.textContent || '説明なし');
          const card = document.createElement('article'); card.className='memory-card';
          card.innerHTML = `<div class="memory-card-content"><h3>${name}</h3><p>${desc}</p><span>📍 My Mapsより</span></div>`;
          container.appendChild(card);
        });
      }).catch(err=>{
        console.warn('KML 読み込みエラー（CORS の可能性あり）:', err);
        const container = $('#cardsContainer');
        const msg = document.createElement('div');
        msg.setAttribute('role','status');
        msg.className = 'memory-card';
        msg.innerHTML = `<div class="memory-card-content"><h3>マップを読み込めませんでした</h3><p>公開設定またはブラウザの制限でマップを取得できませんでした。運営側でサーバプロキシを用意するか、KML を同一オリジンに置いてください。</p></div>`;
        container.appendChild(msg);
      });
    })();

    /* 検索フィルター */
    $('#searchInput').addEventListener('input', e=>{
      const kw = e.target.value.trim().toLowerCase();
      $$('.memory-card, .photo-card').forEach(card=>{
        const t = (card.querySelector('h3')?.textContent || '').toLowerCase();
        card.style.display = t.includes(kw) ? '' : 'none';
      });
    });
  </script>
</body>
</html>
